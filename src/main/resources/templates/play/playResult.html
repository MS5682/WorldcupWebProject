<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>
        ul {list-style: none}
        .graph_wrap {margin: 0 auto;padding:20px;}
        .graph {position: relative;height: 500px;margin-top: 15px;}
        .graph .y-axis {position: absolute;width: 100%;height: 100%;z-index: 1;}
        .graph .y-axis > li {position: relative;width:calc(100% - 20px);height: calc(100% / 8);margin-left: 20px;border-top: 1px solid #8c8c8c;text-align: left;}
        .graph .y-axis > li span {position: absolute;top: -7px;left: -20px;font-size: 12px;line-height: 1;}
        .graph .x-axis {display: flex;justify-content: space-around;position: absolute;bottom: -8px;left: 20px;width: calc(100% - 20px);text-align: center;z-index: 2;}
        .graph .x-axis > li {font-size: 12px;}
        .graph .bar {display: flex;justify-content: space-around;align-items: flex-end;position: absolute;bottom: 45px;left: 20px;width: calc(100% - 20px);height: calc(100% - 16px);text-align: center;z-index: 3;}
        .graph .bar > li {flex-grow:1;margin: 0 10px;}
        .graph .bar > li span {display: inline-block;width: 100%;height: 100%;max-width: 40px;background: #8ab4f8;}

    </style>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous"
</head>
<body style="background-color: lightgray">
    <div class="container" style="background-color: white">
        <!-- Content here -->
        <p class="text-center fs-1 fw-bold" th:text="${worldcup.title}"></p>

        <p class="text-center">ì›”ë“œì»µ íšŸìˆ˜ : 1</p>
    </div>

    <hr>

    <div class="container" style="background-color: white; padding-top: 10px">
        <p class="text-center fs-1 fw-bold">ìˆœìœ„</p>
        <div class="row">
            <div class="col d-flex justify-content-center">
                <div class="card" style="width: 18rem;" th:if="${rank.choice.size() > 0}">
                    <p class="text-center fs-3">ğŸ¥‡1ìœ„</p>
                    <img class="card-img-top" th:if="${rank.choice[0].type == 1}" th:src="@{/worldcup/choice/display(fileName=${rank.choice[0].getImageURL()})}" style="width: 100%; height: 250px;">
                    <img class="card-img-top" th:if="${rank.choice[0].type == 0}" th:src="@{'https://img.youtube.com/vi/' + ${rank.choice[0].imgName} + '/0.jpg'}" style="width: 100%; height: 250px;">
                    <div class="card-body">
                        <h5 class="card-title text-center" th:text="${rank.choice[0].name}"></h5>
                        <p class="card-text">
                            ìŠ¹ë¥ :
                            <span th:text="${#numbers.formatDecimal((rank.choice[0].first * 1.0 / sumFirst * 100), 1,1,'POINT')}"></span>% (
                            <span th:text="${rank.choice[0].first}"></span> /
                            <span th:text="${sumFirst}"></span> )
                        </p>
                        <p class="card-text">ìš°ìŠ¹ íšŸìˆ˜ :
                            <span th:text="${rank.choice[0].first}"></span>íšŒ
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <div class="row" style="margin-top: 10px">
            <div class="col d-flex justify-content-center">
                <div class="card" style="width: 18rem;" th:if="${rank.choice.size() > 1}">
                    <p class="text-start fs-3 text-center" >ğŸ¥ˆ2ìœ„</p>
                    <img class="card-img-top" th:if="${rank.choice[1].type == 1}" th:src="@{/worldcup/choice/display(fileName=${rank.choice[1].getImageURL()})}" style="width: 100%; height: 250px;">
                    <img class="card-img-top" th:if="${rank.choice[1].type == 0}" th:src="@{'https://img.youtube.com/vi/' + ${rank.choice[1].imgName} + '/0.jpg'}" style="width: 100%; height: 250px;">
                    <div class="card-body">
                        <h5 class="card-title text-center" th:text="${rank.choice[1].name}"></h5>
                        <p class="card-text">
                            ìŠ¹ë¥ :
                            <span th:text="${#numbers.formatDecimal((rank.choice[1].first * 1.0 / sumFirst * 100), 1,1,'POINT')}"></span>% (
                            <span th:text="${rank.choice[1].first}"></span> /
                            <span th:text="${sumFirst}"></span> )
                        </p>
                        <p class="card-text">ìš°ìŠ¹ íšŸìˆ˜ :
                            <span th:text="${rank.choice[1].first}"></span>íšŒ
                        </p>
                    </div>
                </div>
            </div>

            <div class="col d-flex justify-content-center">
                <div class="card" style="width: 18rem;" th:if="${rank.choice.size() > 2}">
                    <p class="text-start fs-3 text-center">ğŸ¥‰3ìœ„</p>
                    <img class="card-img-top" th:if="${rank.choice[2].type == 1}" th:src="@{/worldcup/choice/display(fileName=${rank.choice[2].getImageURL()})}" style="width: 100%; height: 250px;">
                    <img class="card-img-top" th:if="${rank.choice[2].type == 0}" th:src="@{'https://img.youtube.com/vi/' + ${rank.choice[2].imgName} + '/0.jpg'}" style="width: 100%; height: 250px;">
                    <div class="card-body">
                        <h5 class="card-title text-center" th:text="${rank.choice[2].name}"></h5>
                        <p class="card-text">
                            ìŠ¹ë¥ :
                            <span th:text="${#numbers.formatDecimal((rank.choice[2].first * 1.0 / sumFirst * 100), 1,1,'POINT')}"></span>% (
                            <span th:text="${rank.choice[2].first}"></span> /
                            <span th:text="${sumFirst}"></span> )
                        </p>
                        <p class="card-text">ìš°ìŠ¹ íšŸìˆ˜ :
                            <span th:text="${rank.choice[2].first}"></span>íšŒ
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <table class="table table-striped">
            <thead>
            <tr>
                <th scope="col" style="width: 5%">ë“±ìˆ˜</th>
                <th scope="col" style="width: 15%">ì´ë¦„</th>
                <th scope="col" style="width: 20%">ì´ë¯¸ì§€</th>
                <th scope="col" style="width: 30%">ìŠ¹ë¥ </th>
                <th scope="col" style="width: 30%">ìš°ìŠ¹ ë¹„ìœ¨</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="choice, choiceStat : ${choices.dtoList}">
                <td class="choice-td" th:text="${choiceStat.count + (choices.page-1) * 5}"></td>
                <td th:text="${choice.name}"></td>
                <td class="choice-td image-preview-td">
                    <img th:if="${choice.type == 1}" th:src="@{/worldcup/choice/display(fileName=${choice.getImageURL()})}" style="max-width: 200px; max-height: 200px;">
                    <img th:if="${choice.type == 0}" th:src="@{'https://img.youtube.com/vi/' + ${choice.imgName} + '/0.jpg'}" style="max-width: 200px; max-height: 200px;">
                </td>
                <td>
                    <label th:text="${#numbers.formatDecimal(((choice.win + choice.lose) != 0 ? (choice.win * 1.0 / (choice.win + choice.lose) * 100) : 0), 1, 1, 'POINT')} + '%'"></label>
                    <div class="progress" role="progressbar" aria-label="Info striped example" th:aria-valuenow="${#numbers.formatDecimal(((choice.win + choice.lose) != 0 ? (choice.win * 1.0 / (choice.win + choice.lose) * 100) : 0), 1, 1, 'POINT')}" aria-valuemin="0" aria-valuemax="100">
                        <div class="progress-bar progress-bar-striped bg-info" th:style="'width: ' + ${#numbers.formatDecimal(((choice.win + choice.lose) != 0 ? (choice.win * 1.0 / (choice.win + choice.lose) * 100) : 0), 1, 1, 'POINT')} + '%'"></div>
                    </div>
                </td>
                <td>
                    <label th:text="${#numbers.formatDecimal((sumFirst != 0 ? (choice.first * 1.0 / sumFirst * 100) : 0), 1, 1, 'POINT')} + '%'"></label>
                    <div class="progress" role="progressbar" aria-label="Info striped example" th:aria-valuenow="${#numbers.formatDecimal((sumFirst != 0 ? (choice.first * 1.0 / sumFirst * 100) : 0), 1, 1, 'POINT')}" aria-valuemin="0" aria-valuemax="100">
                        <div class="progress-bar progress-bar-striped bg-info" th:style="'width: ' + ${#numbers.formatDecimal((sumFirst != 0 ? (choice.first * 1.0 / sumFirst * 100) : 0), 1, 1, 'POINT')} + '%'"></div>
                    </div>
                </td>

            </tr>
            </tbody>
            <tfoot>
            <tr>
                <td colspan="3">
                    <div>
                        <form action="/play/playResult" method="get" id="searchForm">
                            <input type="hidden" name="page" value="1">
                            <input type="hidden" id="worldcupNum" name="worldcupNum" th:value="${worldcup.worldcupNum}">
                            <div class="input-group"  style="width:500px;">
                                <div class="input-group-prepend">
                                    <select class="custom-select form-control" name="type" >
                                        <option th:selected="${pageRequestDTO.type == null}">------</option>
                                        <option th:selected="${pageRequestDTO.type == 'n'}" value="n">ì„ íƒì§€ ì´ë¦„</option>
                                    </select>
                                </div>
                                <input class="form-control" name="keyword" placeholder="í‚¤ì›Œë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”" >
                                <div>
                                    <button class="btn btn-success btn-search" type="button">ê²€ìƒ‰í•˜ê¸°</button>
                                    <button class="btn btn-danger btn-clear" type="button">ìƒˆë¡œê³ ì¹¨</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </td>
                <td colspan="2">
                    <div class="text-center">
                        <ul class="pagination h-100 justify-content-center align-items-center">
                            <li class="page-item" th:if="${choices.prev}">
                                <a class="page-link" th:href="@{/play/playResult(
                                                worldcupNum=${worldcup.worldcupNum},
                                                page=${choices.start - 1},
                                                type=${pageRequestDTO.type},
                                                keyword=${pageRequestDTO.keyword}
                )}" tabindex="-1">Prev</a>
                            </li>
                            <li th:class=" ' page-item ' + ${choices.page == page?'active':''}"
                                th:each="page: ${choices.pageList}" >
                                <a class="page-link" th:href="@{/play/playResult(
                                                worldcupNum=${worldcup.worldcupNum},
                                                page=${page},
                                                type=${pageRequestDTO.type},
                                                keyword=${pageRequestDTO.keyword}
                )}">[[${page}]]</a>
                            </li>
                            <li class="page-item" th:if="${choices.next}">
                                <a class="page-link" th:href="@{/play/playResult(
                                                worldcupNum=${worldcup.worldcupNum},
                                                page=${choices.end + 1},
                                                type=${pageRequestDTO.type},
                                                keyword=${pageRequestDTO.keyword}
                )}">Next</a>
                            </li>
                        </ul>
                    </div>
                </td>
            </tr>
            </tfoot>
        </table>
    </div>

    <hr>

    <div class="container" style="background-color: white">
        <div class="form-check form-switch text-center mb-3">
            <input class="form-check-input" type="checkbox" id="chartSwitch">
            <label class="form-check-label" for="chartSwitch">ì°¨íŠ¸ ë³€ê²½</label>
        </div>

        <div class="graph_wrap">
            <div class="graph">
                <canvas id="myChart"></canvas>
            </div>
        </div>
    </div>



    <hr>

    <div class="container" style="background-color: white">
        <div class="row">
            <div class="col border">
                <p class="fs-4">ëŒ“ê¸€</p>

                <form class="row row-cols-lg-auto g-3 align-items-center">
                    <div class="col-12" style="width: 80%">
                        <div class="form-floating mb-3">
                            <input type="text" class="form-control" id="replyInput" placeholder="name@example.com">
                            <label for="replyInput">ëŒ“ê¸€ ì‘ì„±</label>
                        </div>
                    </div>

                    <div class="col-12" style="min-width: 20px; min-height: 20px">
                        <button type="submit" class="btn btn-primary">ì‘ì„±</button>
                    </div>
                </form>

<!--                ëŒ“ê¸€ ë‚´ìš© í‘œì‹œ ì‹œì‘-->
                <div class="media mb-4">
                    <div class="media-body">
                        <h6 class="mt-0">ë‹‰ë„¤ì„ ë“¤ì–´ê°</h6>
                        <p class="fs-6">ëŒ“ê¸€</p>
                    </div>
                </div>
<!--                ëŒ“ê¸€ ë‚´ìš© í‘œì‹œ ë-->
                <div class="media mb-4">
                    <div class="media-body">
                        <h6 class="mt-0">ë‹‰ë„¤ì„ ë“¤ì–´ê°</h6>
                        <p class="fs-6">ëŒ“ê¸€</p>
                    </div>
                </div>

                <div class="media mb-4">
                    <div class="media-body">
                        <h6 class="mt-0">ë‹‰ë„¤ì„ ë“¤ì–´ê°</h6>
                        <p class="fs-6">ëŒ“ê¸€</p>
                    </div>
                </div>
            </div>
            <div class="col border">
                <p class="fs-4">ìš”ì²­</p>

                <form class="row row-cols-lg-auto g-3 align-items-center">
                    <div class="col-12" style="width: 80%">
                        <div class="form-floating mb-3">
                            <input type="text" class="form-control" id="requestInput" placeholder="name@example.com">
                            <label for="requestInput">ëŒ“ê¸€ë¡œ í›„ë³´ ìš”ì²­</label>
                        </div>
                    </div>

                    <div class="col-12" style="min-width: 20px; min-height: 20px">
                        <button type="submit" class="btn btn-primary">ì‘ì„±</button>
                    </div>
                </form>

                <div class="media mb-4">
                    <div class="media-body">
                        <h6 class="mt-0">ë‹‰ë„¤ì„ ë“¤ì–´ê°</h6>
                        <p class="fs-6">ëŒ“ê¸€</p>
                    </div>
                </div>

                <div class="media mb-4">
                    <div class="media-body">
                        <h6 class="mt-0">ë‹‰ë„¤ì„ ë“¤ì–´ê°</h6>
                        <p class="fs-6">ëŒ“ê¸€</p>
                    </div>
                </div>

                <div class="media mb-4">
                    <div class="media-body">
                        <h6 class="mt-0">ë‹‰ë„¤ì„ ë“¤ì–´ê°</h6>
                        <p class="fs-6">ëŒ“ê¸€</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.8.0/dist/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <script th:inline="javascript">
        var chartData = /*[[${chart}]]*/ '';
        chartData.sort((a, b) => b.first - a.first);
        var labels = [];
        var datas = [];
        var total = 0;
        chartData.forEach(function(choice) {
            labels.push(choice.name);
            datas.push(choice.first);
            total += choice.first;
        });

        var doughnutOptions = {
            plugins: {
                tooltips: {
                    enabled: false
                },
                datalabels: {
                    formatter: function (value, context) {
                        return Math.round(value * 1.0 / context.chart.getDatasetMeta(0).total * 100) + "%";
                    },
                    color: '#fff',
                },
                legend: {
                    display : false
                }
            }
         }

        const configDonut = {
          type: 'doughnut',
          data: {
            labels: labels,
            datasets: [
              {
                data: datas,
                backgroundColor: [
                  'rgba(255, 99, 132, 0.8)',
                  'rgba(54, 162, 235, 0.8)',
                  'rgba(255, 206, 86, 0.8)',
                  'rgba(75, 192, 192, 0.8)',
                  'rgba(153, 102, 255, 0.8)',
                  'rgba(255, 159, 64, 0.8)'
                ]
              }
            ]
          },
          options: doughnutOptions,
          plugins: [ChartDataLabels]
        };

        var barOptions = {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [
                    {
                        data: datas,
                        backgroundColor: [
                          'rgba(255, 99, 132, 0.8)',
                          'rgba(54, 162, 235, 0.8)',
                          'rgba(255, 206, 86, 0.8)',
                          'rgba(75, 192, 192, 0.8)',
                          'rgba(153, 102, 255, 0.8)',
                          'rgba(255, 159, 64, 0.8)'
                        ],
                        borderColor: [
                          'rgba(255, 99, 132, 0.8)',
                          'rgba(54, 162, 235, 0.8)',
                          'rgba(255, 206, 86, 0.8)',
                          'rgba(75, 192, 192, 0.8)',
                          'rgba(153, 102, 255, 0.8)',
                          'rgba(255, 159, 64, 0.8)'
                        ],
                        borderWidth: 1
                    }
                ]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            },
          plugins: [ChartDataLabels]
        };

        $('#chartSwitch').change(function () {
            var isChecked = $(this).is(':checked');
            if (isChecked) {
                myChart.destroy();
                var ctx = document.getElementById('myChart').getContext('2d');
                myChart = new Chart(ctx, barOptions);
            } else {
                myChart.destroy();
                var ctx = document.getElementById('myChart').getContext('2d');
                myChart = new Chart(ctx, configDonut);
            }
        });

        var ctx = document.getElementById('myChart').getContext('2d');
        var myChart = new Chart(ctx, configDonut);
    </script>
    <script>
        $(document).ready(function () {
            var searchForm = $("#searchForm");

            $(".btn-search").click(function(e){
              searchForm.submit();
            });

            $(".btn-clear").click(function(e){
              var worldcupNumValue = searchForm.find('#worldcupNum').val();
              searchForm.empty();
              searchForm.append('<input type="hidden" name="worldcupNum" id="worldcupNum" value="' + worldcupNumValue + '"/>');
              searchForm.submit();

            });

            $('input').keydown(function(event) {
                if (event.keyCode === 13) { // Enter í‚¤ì˜ keyCodeëŠ” 13ì…ë‹ˆë‹¤.
                    event.preventDefault(); // ê¸°ë³¸ ë™ì‘ ì·¨ì†Œ (í¼ ì œì¶œ ë°©ì§€)
                }
            });
        });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm" crossorigin="anonymous"></script>
</body>
</html>