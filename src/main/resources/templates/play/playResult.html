<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>
        ul {list-style: none}
        .graph_wrap {margin: 0 auto;padding:20px;}
        .graph {position: relative;height: 500px;margin-top: 15px;}
        .graph .y-axis {position: absolute;width: 100%;height: 100%;z-index: 1;}
        .graph .y-axis > li {position: relative;width:calc(100% - 20px);height: calc(100% / 8);margin-left: 20px;border-top: 1px solid #8c8c8c;text-align: left;}
        .graph .y-axis > li span {position: absolute;top: -7px;left: -20px;font-size: 12px;line-height: 1;}
        .graph .x-axis {display: flex;justify-content: space-around;position: absolute;bottom: -8px;left: 20px;width: calc(100% - 20px);text-align: center;z-index: 2;}
        .graph .x-axis > li {font-size: 12px;}
        .graph .bar {display: flex;justify-content: space-around;align-items: flex-end;position: absolute;bottom: 45px;left: 20px;width: calc(100% - 20px);height: calc(100% - 16px);text-align: center;z-index: 3;}
        .graph .bar > li {flex-grow:1;margin: 0 10px;}
        .graph .bar > li span {display: inline-block;width: 100%;height: 100%;max-width: 40px;background: #8ab4f8;}

    </style>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link th:href="@{/css/styles.css}" rel="stylesheet">
</head>
<th:block th:replace="main/header :: header"></th:block>

<body>
<main>
    <div class="album py-5 bg-body-tertiary">
    <div class="container">
        <table class="worldcup-result">
            <tr class="worldcup-result-tr">
                <td class="worldcup-result-td">
                    <p class="text-center fs-1 fw-bold" th:text="${worldcup.title}"></p>

                    <p class="text-center" th:text="'Ï°∞ÌöåÏàò : '+${worldcup.viewCnt}"></p>
                </td>
            </tr>
            <tr class="worldcup-result-tr">
                <td class="worldcup-result-td">
                    <p class="text-center fs-1 fw-bold">ÏàúÏúÑ</p>
                    <div class="row">
                        <div class="col d-flex justify-content-center">
                            <div class="card" style="width: 18rem;" th:if="${rank.choice.size() > 0}">
                                <p class="text-center fs-3">ü•á1ÏúÑ</p>
                                <img class="card-img-top" th:if="${rank.choice[0].type == 1}" th:src="@{/worldcup/choice/display(fileName=${rank.choice[0].getImageURL()})}" style="width: 100%; height: 250px;">
                                <img class="card-img-top" th:if="${rank.choice[0].type == 0}" th:src="@{'https://img.youtube.com/vi/' + ${rank.choice[0].imgName} + '/0.jpg'}" style="width: 100%; height: 250px;">
                                <div class="card-body">
                                    <h5 class="card-title text-center" th:text="${rank.choice[0].name}"></h5>
                                    <p>
                                        ÏäπÎ•†:
                                        <span th:text="${#numbers.formatDecimal((sumFirst != 0 ?(rank.choice[0].first * 1.0 / sumFirst * 100) : 0), 1,1,'POINT')}"></span>% (
                                        <span th:text="${rank.choice[0].first}"></span> /
                                        <span th:text="${sumFirst}"></span> )
                                    </p>
                                    <p>Ïö∞Ïäπ ÌöüÏàò :
                                        <span th:text="${rank.choice[0].first}"></span>Ìöå
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row" style="margin-top: 10px">
                        <div class="col d-flex justify-content-center">
                            <div class="card" style="width: 18rem;" th:if="${rank.choice.size() > 1}">
                                <p class="text-start fs-3 text-center" >ü•à2ÏúÑ</p>
                                <img class="card-img-top" th:if="${rank.choice[1].type == 1}" th:src="@{/worldcup/choice/display(fileName=${rank.choice[1].getImageURL()})}" style="width: 100%; height: 250px;">
                                <img class="card-img-top" th:if="${rank.choice[1].type == 0}" th:src="@{'https://img.youtube.com/vi/' + ${rank.choice[1].imgName} + '/0.jpg'}" style="width: 100%; height: 250px;">
                                <div class="card-body">
                                    <h5 class="card-title text-center" th:text="${rank.choice[1].name}"></h5>
                                    <p>
                                        ÏäπÎ•†:
                                        <span th:text="${#numbers.formatDecimal((sumFirst != 0 ?(rank.choice[0].first * 1.0 / sumFirst * 100) : 0), 1,1,'POINT')}"></span>% (
                                        <span th:text="${rank.choice[1].first}"></span> /
                                        <span th:text="${sumFirst}"></span> )
                                    </p>
                                    <p>Ïö∞Ïäπ ÌöüÏàò :
                                        <span th:text="${rank.choice[1].first}"></span>Ìöå
                                    </p>
                                </div>
                            </div>
                        </div>

                        <div class="col d-flex justify-content-center">
                            <div class="card" style="width: 18rem;" th:if="${rank.choice.size() > 2}">
                                <p class="text-start fs-3 text-center">ü•â3ÏúÑ</p>
                                <img class="card-img-top" th:if="${rank.choice[2].type == 1}" th:src="@{/worldcup/choice/display(fileName=${rank.choice[2].getImageURL()})}" style="width: 100%; height: 250px;">
                                <img class="card-img-top" th:if="${rank.choice[2].type == 0}" th:src="@{'https://img.youtube.com/vi/' + ${rank.choice[2].imgName} + '/0.jpg'}" style="width: 100%; height: 250px;">
                                <div class="card-body">
                                    <h5 class="card-title text-center" th:text="${rank.choice[2].name}"></h5>
                                    <p>
                                        ÏäπÎ•†:
                                        <span th:text="${#numbers.formatDecimal((sumFirst != 0 ?(rank.choice[0].first * 1.0 / sumFirst * 100) : 0), 1,1,'POINT')}"></span>% (
                                        <span th:text="${rank.choice[2].first}"></span> /
                                        <span th:text="${sumFirst}"></span> )
                                    </p>
                                    <p>Ïö∞Ïäπ ÌöüÏàò :
                                        <span th:text="${rank.choice[2].first}"></span>Ìöå
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </td>
            </tr>
            <tr class="worldcup-result-tr">
                <td class="worldcup-result-td">
                    <table class="table table-striped">
                        <thead>
                        <tr>
                            <th scope="col" style="width: 5%">Îì±Ïàò</th>
                            <th scope="col" style="width: 15%">Ïù¥Î¶Ñ</th>
                            <th scope="col" style="width: 20%">Ïù¥ÎØ∏ÏßÄ</th>
                            <th scope="col" style="width: 30%">ÏäπÎ•†</th>
                            <th scope="col" style="width: 30%">Ïö∞Ïäπ ÎπÑÏú®</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="choice, choiceStat : ${choices.dtoList}">
                            <td class="choice-td" th:text="${choiceStat.count + (choices.page-1) * 5}"></td>
                            <td class="choice-td" th:text="${choice.name}"></td>
                            <td class="choice-td image-preview-td">
                                <img th:if="${choice.type == 1}" th:src="@{/worldcup/choice/display(fileName=${choice.getImageURL()})}" style="max-width: 200px; max-height: 200px;">
                                <img th:if="${choice.type == 0}" th:src="@{'https://img.youtube.com/vi/' + ${choice.imgName} + '/0.jpg'}" style="max-width: 200px; max-height: 200px;">
                            </td>
                            <td class="choice-td">
                                <label th:text="${#numbers.formatDecimal(((choice.win + choice.lose) != 0 ? (choice.win * 1.0 / (choice.win + choice.lose) * 100) : 0), 1, 1, 'POINT')} + '%'"></label>
                                <div class="progress" role="progressbar" aria-label="Info striped example" th:aria-valuenow="${#numbers.formatDecimal(((choice.win + choice.lose) != 0 ? (choice.win * 1.0 / (choice.win + choice.lose) * 100) : 0), 1, 1, 'POINT')}" aria-valuemin="0" aria-valuemax="100">
                                    <div class="progress-bar progress-bar-striped bg-info" th:style="'width: ' + ${#numbers.formatDecimal(((choice.win + choice.lose) != 0 ? (choice.win * 1.0 / (choice.win + choice.lose) * 100) : 0), 1, 1, 'POINT')} + '%'"></div>
                                </div>
                            </td>
                            <td class="choice-td">
                                <label th:text="${#numbers.formatDecimal((sumFirst != 0 ? (choice.first * 1.0 / sumFirst * 100) : 0), 1, 1, 'POINT')} + '%'"></label>
                                <div class="progress" role="progressbar" aria-label="Info striped example" th:aria-valuenow="${#numbers.formatDecimal((sumFirst != 0 ? (choice.first * 1.0 / sumFirst * 100) : 0), 1, 1, 'POINT')}" aria-valuemin="0" aria-valuemax="100">
                                    <div class="progress-bar progress-bar-striped bg-info" th:style="'width: ' + ${#numbers.formatDecimal((sumFirst != 0 ? (choice.first * 1.0 / sumFirst * 100) : 0), 1, 1, 'POINT')} + '%'"></div>
                                </div>
                            </td>

                        </tr>
                        </tbody>
                        <tfoot>
                        <tr>
                            <td colspan="3">
                                <div>
                                    <form action="/play/playResult" method="get" id="searchForm">
                                        <input type="hidden" name="page" value="1">
                                        <input type="hidden" id="worldcupNum" name="worldcupNum" th:value="${worldcup.worldcupNum}">
                                        <div class="input-group"  style="width:500px;">
                                            <div class="input-group-prepend">
                                                <select class="custom-select form-control" name="type" >
                                                    <option th:selected="${pageRequestDTO.type == null}">------</option>
                                                    <option th:selected="${pageRequestDTO.type == 'n'}" value="n">ÏÑ†ÌÉùÏßÄ Ïù¥Î¶Ñ</option>
                                                </select>
                                            </div>
                                            <input class="form-control" name="keyword" placeholder="ÌÇ§ÏõåÎìúÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî" >
                                            <div>
                                                <button class="btn btn-success btn-search" type="button">Í≤ÄÏÉâÌïòÍ∏∞</button>
                                                <button class="btn btn-danger btn-clear" type="button">ÏÉàÎ°úÍ≥†Ïπ®</button>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </td>
                            <td colspan="2">
                                <div class="text-center">
                                    <ul class="pagination h-100 justify-content-center align-items-center">
                                        <li class="page-item" th:if="${choices.prev}">
                                            <a class="page-link" th:href="@{/play/playResult(
                                                worldcupNum=${worldcup.worldcupNum},
                                                page=${choices.start - 1},
                                                type=${pageRequestDTO.type},
                                                keyword=${pageRequestDTO.keyword}
                )}" tabindex="-1">Prev</a>
                                        </li>
                                        <li th:class=" ' page-item ' + ${choices.page == page?'active':''}"
                                            th:each="page: ${choices.pageList}" >
                                            <a class="page-link" th:href="@{/play/playResult(
                                                worldcupNum=${worldcup.worldcupNum},
                                                page=${page},
                                                type=${pageRequestDTO.type},
                                                keyword=${pageRequestDTO.keyword}
                )}">[[${page}]]</a>
                                        </li>
                                        <li class="page-item" th:if="${choices.next}">
                                            <a class="page-link" th:href="@{/play/playResult(
                                                worldcupNum=${worldcup.worldcupNum},
                                                page=${choices.end + 1},
                                                type=${pageRequestDTO.type},
                                                keyword=${pageRequestDTO.keyword}
                )}">Next</a>
                                        </li>
                                    </ul>
                                </div>
                            </td>
                        </tr>
                        </tfoot>
                    </table>
                </td>
            </tr>

            <tr class="worldcup-result-tr">
                <td class="worldcup-result-td">
                    <div class="container d-flex justify-content-center align-items-center" style="background-color: white; height:1000px">
                        <div class="graph" style="width:800px; height:900px;">
                            <h3>Top 10 Ï∞®Ìä∏</h3>
                            <div class="form-check form-switch mb-3">
                                <input class="form-check-input" type="checkbox" id="chartSwitch">
                                <label class="form-check-label" for="chartSwitch">Ï∞®Ìä∏ Î≥ÄÍ≤Ω</label>
                            </div>
                            <canvas id="myChart"></canvas>
                        </div>
                    </div>
                </td>
            </tr>

            <tr class="worldcup-result-tr">
                <td class="worldcup-result-td">
                    <div class="container" style="background-color: white">
                        <div class="row">
                            <div class="col border">
                                <p class="fs-4">ÎåìÍ∏Ä</p>

                                <form class="row row-cols-lg-auto g-3 align-items-center">
                                    <div class="col-12" style="width: 80%">
                                        <div class="form-floating mb-3">
                                            <input type="text" class="form-control" id="replyInput" placeholder="name@example.com">
                                            <label for="replyInput">ÎåìÍ∏Ä ÏûëÏÑ±</label>
                                        </div>
                                    </div>

                                    <div class="col-12" style="min-width: 20px; min-height: 20px">
                                        <button type="submit" class="btn btn-primary">ÏûëÏÑ±</button>
                                    </div>
                                </form>

                                <!--                ÎåìÍ∏Ä ÎÇ¥Ïö© ÌëúÏãú ÏãúÏûë-->
                                <div class="media mb-4">
                                    <div class="media-body">
                                        <h6 class="mt-0">ÎãâÎÑ§ÏûÑ Îì§Ïñ¥Í∞ê</h6>
                                        <p class="fs-6">ÎåìÍ∏Ä</p>
                                    </div>
                                </div>
                                <!--                ÎåìÍ∏Ä ÎÇ¥Ïö© ÌëúÏãú ÎÅù-->
                                <div class="media mb-4">
                                    <div class="media-body">
                                        <h6 class="mt-0">ÎãâÎÑ§ÏûÑ Îì§Ïñ¥Í∞ê</h6>
                                        <p class="fs-6">ÎåìÍ∏Ä</p>
                                    </div>
                                </div>

                                <div class="media mb-4">
                                    <div class="media-body">
                                        <h6 class="mt-0">ÎãâÎÑ§ÏûÑ Îì§Ïñ¥Í∞ê</h6>
                                        <p class="fs-6">ÎåìÍ∏Ä</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col border">
                                <p class="fs-4">ÏöîÏ≤≠</p>

                                <form class="row row-cols-lg-auto g-3 align-items-center">
                                    <div class="col-12" style="width: 80%">
                                        <div class="form-floating mb-3">
                                            <input type="text" class="form-control" id="requestInput" placeholder="name@example.com">
                                            <label for="requestInput">ÎåìÍ∏ÄÎ°ú ÌõÑÎ≥¥ ÏöîÏ≤≠</label>
                                        </div>
                                    </div>

                                    <div class="col-12" style="min-width: 20px; min-height: 20px">
                                        <button type="submit" class="btn btn-primary">ÏûëÏÑ±</button>
                                    </div>
                                </form>

                                <div class="media mb-4">
                                    <div class="media-body">
                                        <h6 class="mt-0">ÎãâÎÑ§ÏûÑ Îì§Ïñ¥Í∞ê</h6>
                                        <p class="fs-6">ÎåìÍ∏Ä</p>
                                    </div>
                                </div>

                                <div class="media mb-4">
                                    <div class="media-body">
                                        <h6 class="mt-0">ÎãâÎÑ§ÏûÑ Îì§Ïñ¥Í∞ê</h6>
                                        <p class="fs-6">ÎåìÍ∏Ä</p>
                                    </div>
                                </div>

                                <div class="media mb-4">
                                    <div class="media-body">
                                        <h6 class="mt-0">ÎãâÎÑ§ÏûÑ Îì§Ïñ¥Í∞ê</h6>
                                        <p class="fs-6">ÎåìÍ∏Ä</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </td>
            </tr>
        </table>




    </div>


    </div>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.8.0/dist/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <script th:inline="javascript">
        var chartData = /*[[${chart}]]*/ '';
        chartData.sort((a, b) => b.first - a.first);
        var labels = [];
        var datas = [];
        var total = 0;
        chartData.forEach(function(choice) {
            labels.push(choice.name);
            datas.push(choice.first);
            total += choice.first;
        });

        var doughnutOptions = {
            plugins: {
                tooltips: {
                    enabled: false
                },
                datalabels: {
                    formatter: function (value, context) {
                        return context.chart.data.labels[context.dataIndex] + ' ' +  Math.round(value * 1.0 / context.chart.getDatasetMeta(0).total * 100) + "%";
                    },
                    color: '#000'
                },
                legend: {
                    display : false
                }
            }
         }
        var barOptions = {
         scales: {
            y: {
                ticks: {
                    callback: function(value, index, values) {
                        return Math.round(value / total * 100) + '%'; // Î∞±Î∂ÑÏú®Î°ú Î≥ÄÌôòÌïòÏó¨ ÌëúÏãú
                    }
                }
            }
        },
            plugins: {
                datalabels: {
                    formatter: function (value, context) {
                        return context.chart.data.labels[context.dataIndex] + ' ' + Math.round(value * 1.0 / context.chart.data.datasets[0].data.reduce((a, b) => a + b, 0) * 100) + '%';
                    },
                    color: '#000',
                },
                legend: {
                    display: false
                }
            }
        };

        const configDonut = {
          type: 'doughnut',
          data: {
            labels: labels,
            datasets: [
              {
                data: datas,
                backgroundColor: [
                  'rgba(255, 99, 132, 0.8)',
                  'rgba(54, 162, 235, 0.8)',
                  'rgba(255, 206, 86, 0.8)',
                  'rgba(75, 192, 192, 0.8)',
                  'rgba(153, 102, 255, 0.8)',
                  'rgba(255, 159, 64, 0.8)'
                ]
              }
            ]
          },
          options: doughnutOptions,
          plugins: [ChartDataLabels]
        };

        var barOptions = {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [
                    {
                        data: datas,
                        backgroundColor: [
                          'rgba(255, 99, 132, 0.8)',
                          'rgba(54, 162, 235, 0.8)',
                          'rgba(255, 206, 86, 0.8)',
                          'rgba(75, 192, 192, 0.8)',
                          'rgba(153, 102, 255, 0.8)',
                          'rgba(255, 159, 64, 0.8)'
                        ],
                        borderColor: [
                          'rgba(255, 99, 132, 0.8)',
                          'rgba(54, 162, 235, 0.8)',
                          'rgba(255, 206, 86, 0.8)',
                          'rgba(75, 192, 192, 0.8)',
                          'rgba(153, 102, 255, 0.8)',
                          'rgba(255, 159, 64, 0.8)'
                        ],
                        borderWidth: 1
                    }
                ]
            },
          options: barOptions,
          plugins: [ChartDataLabels]
        };

        $('#chartSwitch').change(function () {
            var isChecked = $(this).is(':checked');
            if (isChecked) {
                myChart.destroy();
                var ctx = document.getElementById('myChart').getContext('2d');
                myChart = new Chart(ctx, barOptions);
            } else {
                myChart.destroy();
                var ctx = document.getElementById('myChart').getContext('2d');
                myChart = new Chart(ctx, configDonut);
            }
        });
        if(total != 0){
            var ctx = document.getElementById('myChart').getContext('2d');
            var myChart = new Chart(ctx, configDonut);
        }else {
            var canvas = document.getElementById('myChart');
            var ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.font = '24px Arial';
            ctx.fillStyle = '#000';
            ctx.textAlign = 'center';
            ctx.fillText('Ïö∞Ïäπ Îç∞Ïù¥ÌÑ∞ ÏóÜÏùå', canvas.width / 2, canvas.height / 2);
        }

    </script>
    <script>
        $(document).ready(function () {
            var searchForm = $("#searchForm");

            $(".btn-search").click(function(e){
              searchForm.submit();
            });

            $(".btn-clear").click(function(e){
              var worldcupNumValue = searchForm.find('#worldcupNum').val();
              searchForm.empty();
              searchForm.append('<input type="hidden" name="worldcupNum" id="worldcupNum" value="' + worldcupNumValue + '"/>');
              searchForm.submit();

            });

            $('input').keydown(function(event) {
                if (event.keyCode === 13) { // Enter ÌÇ§Ïùò keyCodeÎäî 13ÏûÖÎãàÎã§.
                    event.preventDefault(); // Í∏∞Î≥∏ ÎèôÏûë Ï∑®ÏÜå (Ìèº Ï†úÏ∂ú Î∞©ÏßÄ)
                }
            });
        });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm" crossorigin="anonymous"></script>
</body>

</main>
<th:block th:replace="main/footer :: footer"></th:block>
</html>

